version: "3"
services:
  shell:
    image: lscr.io/linuxserver/openssh-server:version-8.6_p1-r3
    container_name: yscialom_devenv_shell
    hostname: shell
    env_file:
      - .env
    environment:
      - PUBLIC_KEY_FILE=/config/.ssh/id_rsa.pub
      - SUDO_ACCESS=true
      - PASSWORD_ACCESS=false
      - VERSION=0.1.0
    ports:
      - "13722:2222"
    volumes:
      - ./common/custom-cont-init.d/master-install.sh:/config/custom-cont-init.d/master-install.sh:ro # master install
      - ./shell/install-scripts:/ysc/install-scripts/00_shell:ro                                      # installation scripts
      - ./ansible/install-scripts:/ysc/install-scripts/10_ansible:ro                                  # installation scripts
      - ./shell/oh-my-zsh-config:/ysc/oh-my-zsh-config:ro                                             # user settings
      - ./shell/git-config:/ysc/git-config:ro                                                         # git settings
      - ~/.ssh/id_rsa:/config/.ssh/id_rsa:ro                                                          # client ssh private key
      - ~/.ssh/id_rsa.pub:/config/.ssh/id_rsa.pub:ro                                                  # client ssh public key
      - ${HOST_WORK_DIR}/shell.sshdata:/config/ssh_host_keys                                          # server ssh keys
      - ${HOST_WORK_DIR}/shell.codedata:/config/workspace                                             # workspace
    networks:
      - yscialom_devenv
    restart: unless-stopped

  agnide:
    image: lscr.io/linuxserver/code-server:3.12.0
    container_name: yscialom_devenv_agnide
    hostname: agnide
    ports:
      - "13780:8443"
    env_file:
      - .env
    volumes:
      - ./common/custom-cont-init.d/master-install.sh:/config/custom-cont-init.d/master-install.sh:ro # master install
      - ./agnide/install-scripts:/ysc/install-scripts/agnide:ro                                       # installation scripts
      - ./agnide/vs-code:/ysc/vs-code:ro                                                              # user settings
      - ./agnide/fonts/fonts.html:/ysc/fonts/fonts.html:ro                                            # fonts
      - ~/.ssh/id_rsa:/config/.ssh/id_rsa:ro                                                          # client ssh private key
      - ~/.ssh/id_rsa.pub:/config/.ssh/id_rsa.pub:ro                                                  # client ssh public key
      - ${HOST_WORK_DIR}/shell.codedata:/config/workspace                                             # workspace
    networks:
      - yscialom_devenv
    restart: unless-stopped

networks:
  yscialom_devenv:
